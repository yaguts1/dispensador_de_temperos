# ğŸ”§ WiFi Dual Mode - Arquitetura Visual

## Sistema Antes vs Depois

### ANTES (v0.1.4) - Single Mode

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ESP32 v0.1.4                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  Modo 1: Portal (AP Only)              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”‚
â”‚  âŒ WiFi configurado? NÃƒO              â”‚
â”‚  â””â”€ Inicia: WIFI_AP                   â”‚
â”‚     â””â”€ HTTP: 192.168.4.1              â”‚
â”‚     â””â”€ DNS: Portal SSID               â”‚
â”‚                                        â”‚
â”‚  VS                                    â”‚
â”‚                                        â”‚
â”‚  Modo 2: Online (STA Only)            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€             â”‚
â”‚  âœ“ WiFi configurado? SIM              â”‚
â”‚  â””â”€ Inicia: WIFI_STA                  â”‚
â”‚     â””â”€ Conecta Yaguts                 â”‚
â”‚     â””â”€ Executa jobs                   â”‚
â”‚     â””â”€ âŒ AP nÃ£o disponÃ­vel            â”‚
â”‚                                        â”‚
â”‚  âš  Problema:                          â”‚
â”‚  â””â”€ NÃ£o pode mudar de WiFi online    â”‚
â”‚  â””â”€ Requer RESET FÃSICO               â”‚
â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### DEPOIS (v0.1.5) - Dual Mode

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ESP32 v0.1.5 - WiFiDualMode           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                â”‚
â”‚  Modo APSTA (Access Point + Station)          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—   â”‚
â”‚  â•‘   Access Point    â•‘    Station        â•‘   â”‚
â”‚  â•‘   (Local Server)  â•‘  (Yaguts Client)  â•‘   â”‚
â”‚  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£   â”‚
â”‚  â•‘ SSID: Yaguts-... â•‘ SSID: WiFi-Lab    â•‘   â”‚
â”‚  â•‘ IP: 192.168.4.1 â•‘ IP: 192.168.1.x  â•‘   â”‚
â”‚  â•‘ Porta: 80       â•‘                   â•‘   â”‚
â”‚  â•‘ Hotspot SEMPRE â•‘ Conectado SEMPRE  â•‘   â”‚
â”‚  â•‘ ativo          â•‘ (quando online)    â•‘   â”‚
â”‚  â•‘                â•‘ Reconecta auto    â•‘   â”‚
â”‚  â•‘ â€¢ Config       â•‘ (se cair)         â•‘   â”‚
â”‚  â•‘ â€¢ Re-pareamentoâ•‘                   â•‘   â”‚
â”‚  â•‘ â€¢ Monitoring   â•‘ â€¢ Jobs            â•‘   â”‚
â”‚  â•‘                â•‘ â€¢ Heartbeat       â•‘   â”‚
â”‚  â•‘                â•‘ â€¢ Status API      â•‘   â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                â”‚
â”‚  âœ“ BenefÃ­cios:                                â”‚
â”‚  â”œâ”€ Re-pareamento online (sem reset)         â”‚
â”‚  â”œâ”€ Hotspot sempre disponÃ­vel                â”‚
â”‚  â”œâ”€ Fallback automÃ¡tico se WiFi cair        â”‚
â”‚  â”œâ”€ ReconexÃ£o automÃ¡tica a cada 15s          â”‚
â”‚  â””â”€ Monitoramento em tempo real              â”‚
â”‚                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Fluxo de Dados - Dual Mode

```
Internet (Router WiFi)
     â”‚
     â”‚ 192.168.1.x
     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                               â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  ESP32 v0.1.5 â”‚
                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚              â”‚              â”‚
                â–¼              â–¼              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ STA LAYER   â”‚  â”‚ AP LAYER    â”‚  â”‚ SERVO   â”‚
         â”‚  (Station)  â”‚  â”‚ (Access Pt) â”‚  â”‚ CONTROL â”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                â”‚                â”‚              â”‚
         Yaguts API      Local Config       PCA9685
         (Production)     (Re-pairing)       (RelÃ©s)


ComunicaÃ§Ã£o:
â”œâ”€ STA â†” Internet (WiFi-Lab) â†’ api.yaguts.com.br
â”œâ”€ AP â†” Local Devices â†’ http://192.168.4.1
â””â”€ SERVO â†” I2C â†’ 4 Servos SG90
```

---

## State Machine Detalhado

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STATE TRANSITIONS                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                 â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                 â•‘ ST_CONFIG_PORTAL   â•‘
                 â•‘ (Parado/Inicial)   â•‘
                 â•šâ•â•â•â•â•â•â•â•â•â”¬â•â•â•â•â•â•â•â•â•â•â•
                           â”‚
                     [WiFi config OK]
                     [Salva em Flash]
                           â”‚
                           â–¼
          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
          â•‘   ST_WIFI_CONNECT                  â•‘
          â•‘   â€¢ Inicia APSTA                   â•‘
          â•‘   â€¢ Ativa AP (hotspot)             â•‘
          â•‘   â€¢ Tenta STA (WiFi Yaguts)        â•‘
          â•‘   â€¢ Ambos simultÃ¢neos              â•‘
          â•šâ•â•â•â•â•â•â•â•â•â”¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    â”‚
            [Conectou STA]
            [doClaim OK]
                    â”‚
                    â–¼
          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
          â•‘   ST_ONLINE                        â•‘
          â•‘   â€¢ AP: SEMPRE ATIVO âœ“             â•‘
          â•‘   â€¢ STA: Conectado âœ“               â•‘
          â•‘   â€¢ Executa jobs                   â•‘
          â•‘   â€¢ Reconecta auto se cair         â•‘
          â•‘   â€¢ HTTP endpoints disponÃ­veis     â•‘
          â•šâ•â•â•â•â•â•â•â•â•â”¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    â”‚
            [WiFi Yaguts cai]
            [Reconecta falha]
                    â”‚
                    â–¼
              ST_WIFI_CONNECT â”€â”
              (retry loop)     â”‚ [WiFi Yaguts volta]
                               â”‚
                               â–¼
                          ST_ONLINE


APSTA em paralelo (ambos sempre):

  STA STATE          AP STATE
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  WL_DISCONNECTED â†” AP_ACTIVE
  WL_SCAN_DONE    â†” AP_ACTIVE
  WL_CONNECTED    â†” AP_ACTIVE âœ“âœ“
```

---

## Classe WiFiDualMode

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       WiFiDualMode                         â”‚
â”‚       (Gerencia AP+STA)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                            â”‚
â”‚ Propriedades:                              â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                              â”‚
â”‚ â€¢ ap_ssid_current: String                  â”‚
â”‚ â€¢ ap_password: "yaguts123"                 â”‚
â”‚ â€¢ ap_channel: 11                           â”‚
â”‚ â€¢ max_connections: 2                       â”‚
â”‚                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MÃ©todos PÃºblicos:                          â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                           â”‚
â”‚                                            â”‚
â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚ â•‘ initAPSTA(device_id)                 â•‘  â”‚
â”‚ â•‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â•‘  â”‚
â”‚ â•‘ â€¢ WiFi.mode(WIFI_MODE_APSTA)        â•‘  â”‚
â”‚ â•‘ â€¢ Inicia AP                          â•‘  â”‚
â”‚ â•‘ â€¢ Retorna: true/false                â•‘  â”‚
â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                            â”‚
â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚ â•‘ startAccessPoint()                   â•‘  â”‚
â”‚ â•‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â•‘  â”‚
â”‚ â•‘ â€¢ WiFi.softAP(ssid, pwd, ch, ...)   â•‘  â”‚
â”‚ â•‘ â€¢ Config IP: 192.168.4.1             â•‘  â”‚
â”‚ â•‘ â€¢ Retorna: true/false                â•‘  â”‚
â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                            â”‚
â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚ â•‘ connectToYaguts(ssid, pwd)           â•‘  â”‚
â”‚ â•‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â•‘  â”‚
â”‚ â•‘ â€¢ WiFi.begin(ssid, pwd)             â•‘  â”‚
â”‚ â•‘ â€¢ Aguarda WL_CONNECTED (max 30s)    â•‘  â”‚
â”‚ â•‘ â€¢ AP permanece ativo                 â•‘  â”‚
â”‚ â•‘ â€¢ Retorna: true/false                â•‘  â”‚
â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                            â”‚
â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚ â•‘ reconnectToYaguts()                  â•‘  â”‚
â”‚ â•‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â•‘  â”‚
â”‚ â•‘ â€¢ WiFi.reconnect()                  â•‘  â”‚
â”‚ â•‘ â€¢ Chamada periodicamente (15s)       â•‘  â”‚
â”‚ â•‘ â€¢ AP inalterado                      â•‘  â”‚
â”‚ â•‘ â€¢ Retorna: void                      â•‘  â”‚
â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                            â”‚
â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
â”‚ â•‘ getStatus()                          â•‘  â”‚
â”‚ â•‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â•‘  â”‚
â”‚ â•‘ Retorna: Status {                    â•‘  â”‚
â”‚ â•‘   bool ap_active                     â•‘  â”‚
â”‚ â•‘   bool sta_connected                 â•‘  â”‚
â”‚ â•‘   String ap_ip                       â•‘  â”‚
â”‚ â•‘   String sta_ip                      â•‘  â”‚
â”‚ â•‘   int rssi                           â•‘  â”‚
â”‚ â•‘ }                                    â•‘  â”‚
â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## HTTP API - Endpoints

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ESP32 HTTP Server (0.1.5)             â”‚
â”‚         Hotspot: 192.168.4.1:80              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                               â”‚
â”‚ GET /                                         â”‚
â”‚ â”œâ”€ Retorna: HTML (pÃ¡gina config)             â”‚
â”‚ â””â”€ CORS: Nenhum (local only)                â”‚
â”‚                                               â”‚
â”‚ GET /info                                     â”‚
â”‚ â”œâ”€ Retorna: {uid, mac, fw, rssi, ip}        â”‚
â”‚ â”œâ”€ Uso: Diagnostics                         â”‚
â”‚ â””â”€ Status: 200 OK / Sempre                  â”‚
â”‚                                               â”‚
â”‚ GET /connectivity-status â˜… NOVO              â”‚
â”‚ â”œâ”€ Retorna: {                                â”‚
â”‚ â”‚   ap_active: bool,                         â”‚
â”‚ â”‚   sta_connected: bool,                     â”‚
â”‚ â”‚   ap_ip: "192.168.4.1",                   â”‚
â”‚ â”‚   sta_ip: "192.168.1.x",                  â”‚
â”‚ â”‚   rssi: -45,                              â”‚
â”‚ â”‚   ap_ssid: "Yaguts-..."                   â”‚
â”‚ â”‚ }                                          â”‚
â”‚ â”œâ”€ Uso: Monitor dual mode em tempo real      â”‚
â”‚ â””â”€ Status: 200 OK / APSTA                   â”‚
â”‚                                               â”‚
â”‚ POST /save                                    â”‚
â”‚ â”œâ”€ Form: {ssid, pass, claim, api}           â”‚
â”‚ â”œâ”€ AÃ§Ã£o: Salva em Flash, reconecta           â”‚
â”‚ â””â”€ Status: 200 OK / Redireciona             â”‚
â”‚                                               â”‚
â”‚ POST /wipe                                    â”‚
â”‚ â”œâ”€ AÃ§Ã£o: Limpa Flash, reinicia              â”‚
â”‚ â””â”€ Status: 200 OK / Reboot                  â”‚
â”‚                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Consumo de Recursos

### MemÃ³ria (RAM)

```
Antes (v0.1.4)
â””â”€ AP: ~30 KB
   STA: ~40 KB
   Stack apps: ~70 KB
   Livre: ~60 KB
   Total: 200 KB

Depois (v0.1.5)
â”œâ”€ AP: ~35 KB  (+5 KB)
â”œâ”€ STA: ~40 KB  (igual)
â”œâ”€ WiFiDualMode: ~5 KB  (nova classe)
â”œâ”€ Stack apps: ~75 KB  (+5 KB)
â””â”€ Livre: ~45 KB
   Total: 200 KB
   
Î” DiferenÃ§a: +15 KB no pico, -15 KB em standby
```

### CPU (durante APSTA)

```
OperaÃ§Ã£o          Antes    Depois    Î”
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
WiFi scan         100%     50%      -50% (paralelo)
Connection        100%     50%      -50% (paralelo)
Jobs              100%     100%      Â±0
Idle              ~10%     ~15%      +5% (daemon reconexÃ£o)
```

### Bateria (estimativa)

```
Modo            Consumo    DiferenÃ§a
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Online STA      90 mA      (baseline)
Online APSTA    95 mA      +5%
Standby AP      50 mA      (novo)
Fallback        100 mA     +11%
```

---

## Roadmap - PrÃ³ximas Fases

```
v0.1.5 (ATUAL)
â””â”€ âœ“ WiFi Dual Mode (APSTA)
   âœ“ ReconexÃ£o automÃ¡tica
   âœ“ Hotspot persistente
   âœ“ Endpoint /connectivity-status

v0.1.6 (Proposto)
â””â”€ Dashboard web no hotspot
   EstatÃ­sticas em tempo real
   HistÃ³rico de jobs
   Logs de erro
   Reset remoto

v0.1.7 (Proposto)
â””â”€ OTA (Over-The-Air) updates
   VerificaÃ§Ã£o de firmware
   Download automÃ¡tico
   Rollback em falha
   NotificaÃ§Ã£o ao Yaguts
```

---

## Diagrama de SequÃªncia - Re-pareamento

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Re-pareamento Online (APSTA)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Usuario    Hotspot       Flash       WiFi-Novo    Yaguts
     â”‚          â”‚            â”‚            â”‚           â”‚
     â”‚â”€ WiFi â”€â”€â†’â”‚ (conectado ao "Yaguts-XXXX")        â”‚
     â”‚          â”‚            â”‚            â”‚           â”‚
     â”‚â”€ HTTP â”€â”€â†’â”‚ GET /      â”‚            â”‚           â”‚
     â”‚â†â”€ HTML â”€â”€â”‚            â”‚            â”‚           â”‚
     â”‚          â”‚            â”‚            â”‚           â”‚
     â”‚â”€ POST /save (novo WiFi + code)â”€â”€â”€â”‚            â”‚
     â”‚          â”‚            â”‚            â”‚           â”‚
     â”‚          â”‚â”€â”€ Save â”€â”€â”€â”€â”‚            â”‚           â”‚
     â”‚          â”‚â† Saved â”€â”€â”€â”€â”‚            â”‚           â”‚
     â”‚          â”‚            â”‚            â”‚           â”‚
     â”‚â†â”€ "OK. Reconectando" â”€â”€â”‚            â”‚           â”‚
     â”‚          â”‚            â”‚            â”‚           â”‚
     â”‚          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€ Connect â”€â”€â”€â”€â”€â†’â”‚           â”‚
     â”‚          â”‚            â”‚            â”‚           â”‚
     â”‚          â”‚            â”‚            â”‚â”€ Claim â”€â”€â†’â”‚
     â”‚          â”‚            â”‚            â”‚â† Token â”€â”€â”€â”‚
     â”‚          â”‚            â”‚            â”‚           â”‚
     â”‚          â”‚            â”‚            â”‚â†â”€ Claim OK
     â”‚          â”‚            â”‚            â”‚           â”‚
     â”‚          â”‚â”€â”€â”€â”€â”€â”€ AP Ativo (sempre!) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
     â”‚          â”‚            â”‚            â”‚           â”‚
     â”‚          â”‚â†â”€ STA Conectado                     â”‚
     â”‚          â”‚            â”‚            â”‚           â”‚
     â”‚          â”‚(Continua com AP + STA)  â”‚           â”‚
     â”‚          â”‚            â”‚            â”‚           â”‚
     â”‚â†â”€â”€eof â”€â”€â”€â”‚            â”‚            â”‚           â”‚
     â”‚          â”‚            â”‚            â”‚           â”‚
     
Status Final: âœ“ AP ativo + âœ“ STA conectado

(Se falhar WiFi-Novo â†’ AP permanece ativo para retry)
```

---

## Tabela Comparativa - Antes vs Depois

| Recurso | v0.1.4 | v0.1.5 | Melhoria |
|---------|--------|--------|----------|
| **AP + STA simultÃ¢neo** | âŒ | âœ… | Re-pareamento online |
| **Hotspot persistente** | âŒ | âœ… | Fallback garantido |
| **ReconexÃ£o automÃ¡tica** | Manual | AutomÃ¡tico | 24/7 disponibilidade |
| **Re-pareamento** | Reset fÃ­sico | Via hotspot | Sem intervenÃ§Ã£o |
| **Status endpoint** | âŒ | âœ… | Monitoramento real-time |
| **RAM utilizada** | 200 KB | 215 KB | +7.5% |
| **Bateria** | 90 mA | 95 mA | +5% |
| **Uptime teÃ³rico** | 90% | 99% | +9% |

---

**VersÃ£o Documento**: 1.0  
**Data**: Nov 15, 2025  
**Status**: âœ… Implementado  
**PrÃ³xima Review**: v0.1.6
